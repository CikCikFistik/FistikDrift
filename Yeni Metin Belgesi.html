<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<style>
  html,body{
    height:100%;
    margin:0;
    overflow:hidden;
    background:#e8ffe6;
    font-family:Arial, sans-serif;
  }

  #menu{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#e8ffe6;
    z-index:9999;
  }

  #menuCard{
    width:520px;
    max-width:90%;
    background:rgba(255,255,255,0.05);
    padding:28px;
    border-radius:12px;
    text-align:center;
    box-shadow:0 10px 40px rgba(0,0,0,0.2);
  }

  #menuCard h1{
    margin:4px 0 18px 0;
    font-size:44px;
    color:#062a06;
  }

  #playBtn{
    padding:14px 34px;
    font-size:20px;
    background:#0bb34b;
    color:white;
    border:0;
    border-radius:8px;
    cursor:pointer;
  }

  #rayToggle{
    display:none;
    position:fixed;
    top:12px;
    left:12px;
    z-index:9998;
    padding:8px 12px;
    background:rgba(0,0,0,0.45);
    color:white;
    border-radius:8px;
    cursor:pointer;
  }

  canvas{
    position:absolute;
    inset:0;
  }
</style>
</head>

<body>

<!-- MENU -->
<div id="menu">
  <div id="menuCard">
    <h1>Fistik Drift</h1>
    <p style="margin-top:-8px;color:#083b08;">Open world drift game</p>
    <button id="playBtn">Play</button>
  </div>
</div>

<div id="rayToggle">Ray Tracing: OFF</div>

<!-- THREE.JS CDN (Wix uyumlu) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>

<script>
let renderer, scene, camera, car;
let keys = {};
let velocity = 0, turn = 0;
let rayOn = false;

const menu = document.getElementById("menu");
const playBtn = document.getElementById("playBtn");
const rayBtn = document.getElementById("rayToggle");

playBtn.onclick = () => {
  startGame();
  menu.remove();
  rayBtn.style.display = "block";
};

rayBtn.onclick = () => {
  rayOn = !rayOn;
  rayBtn.textContent = "Ray Tracing: " + (rayOn ? "ON" : "OFF");
  applyRay();
};

function startGame(){

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setClearColor(0xaee9b8);

  document.body.appendChild(renderer.domElement);

  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(65, window.innerWidth/window.innerHeight, 0.1, 2000);
  camera.position.set(0,5,10);

  const light = new THREE.HemisphereLight(0xffffff,0x444444,1);
  light.position.set(0,20,0);
  scene.add(light);

  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(2000,2000),
    new THREE.MeshStandardMaterial({color:0x3b3b3b})
  );
  ground.rotation.x = -Math.PI/2;
  scene.add(ground);

  car = new THREE.Mesh(
    new THREE.BoxGeometry(1.6,0.6,3.6),
    new THREE.MeshStandardMaterial({color:0xff3333})
  );
  car.position.y = 0.4;
  scene.add(car);

  animate();
}

window.onkeydown = e => keys[e.key.toLowerCase()] = true;
window.onkeyup   = e => keys[e.key.toLowerCase()] = false;

function animate(){
  requestAnimationFrame(animate);

  const accel = (keys["w"]?1:0) - (keys["s"]?1:0);
  const steer = (keys["a"]?1:0) - (keys["d"]?1:0);

  velocity += accel * 0.05;
  velocity *= 0.99;
  if(velocity > 25) velocity = 25;

  turn += steer * 0.05;
  turn *= 0.9;

  car.rotation.y += turn * 0.05;
  car.position.x += Math.sin(car.rotation.y) * velocity * 0.12;
  car.position.z += Math.cos(car.rotation.y) * velocity * 0.12;

  const camTarget = new THREE.Vector3(
    car.position.x - Math.sin(car.rotation.y)*7,
    car.position.y + 3,
    car.position.z - Math.cos(car.rotation.y)*7
  );

  camera.position.lerp(camTarget, 0.08);
  camera.lookAt(car.position);

  renderer.render(scene, camera);
}

function applyRay(){
  renderer.toneMappingExposure = rayOn ? 1.2 : 1.0;
}

window.onresize = () => {
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
};
</script>

</body>
</html>
